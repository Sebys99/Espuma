<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/etapa3.css" />
    <script src="/borrow.min.js"></script>
    <audio id="audio" src="/audios/glitch.mp3" preload="auto"></audio>
    <link href="https://fonts.googleapis.com/css2?family=Rubik+Glitch&display=swap" rel="stylesheet">
    <title>Document</title>
</head>
<body>
    <main>
        <div class="chat-fase-1">
            <svg id="chat-fase-1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1280 1024">
            <!-- Generator: Adobe Illustrator 29.4.0, SVG Export Plug-In . SVG Version: 2.1.0 Build 152)  -->
            <defs>
                <style>
                .st0, .st1, .st2, .st3, .st4 {
                    stroke-miterlimit: 10;
                    stroke-width: 6px;
                }

                .st0, .st1, .st3, .st4 {
                    stroke: #04434a;
                }

                .st0, .st2 {
                    fill: none;
                }

                .st5 {
                    fill: #331521;
                }

                .st6, .st7, .st8, .st9 {
                    font-family: 'Rubik Glitch', sans-serif;

                }

                .st6, .st10, .st11, .st9 {
                    isolation: isolate;
                }

                .st11 {
                    font-size: 15px;
                }

                .st6 {
                    font-size: 24px;
                }
                
                .st6, .st11, .st9 {
                    fill: #eddcdc;
                }

                .st7 {
                    letter-spacing: 0em;
                }

                .st1 {
                    fill: #321124;
                }

                .st2 {
                    stroke: #d2ff86;
                }

                .st3 {
                    fill: #532748;
                }

                .st12 {
                    fill: #220f22;
                }

                .st4 {
                    fill: #045163;
                }

                .st13 {
                    font-family: 'Rubik Glitch', sans-serif;
                }

                .st14 {
                    fill: #b3b3b3;
                }

                .st15 {
                    fill: #331426;
                }

                .st9 {
                    font-size: 21px;
                }
                </style>
            </defs>
            <path class="st3" d="M814.22,254.17c-34.05-30.34-64.99-69.55-69.24-116.19h-364.56v191.42c10.15,5.29,17.94,14.73,23.65,24.45,10.71,18.21,17.19,42.7,5.3,61.92-7.09,11.46-18.87,18.31-28.96,26.78v211.94h502.28v-344.57c-23.81-17.33-46.54-36.2-68.48-55.75h.01Z"/>
            <path class="st4" d="M559.42,831.54c-23.81-8.21-48.26-10.5-73.15-6.49-16.92,2.73-35.15,8.38-44.85,23.62-3.24,5.1-5.45,10.69-6.98,16.52h194.4c-1.61-.85-3.22-1.71-4.82-2.57-21.03-11.3-41.94-23.26-64.59-31.08h0Z"/>
            <path class="st1" d="M735.21,82.74h-354.79v55.24h363.05c-4.75-18.04-7.4-36.59-8.26-55.24Z"/>
            <path class="st3" d="M809.73,166.29c23.7,55.81,69.07,98.16,119.08,130.71V79.77h-137.58c1.13,29.67,6.83,59.05,18.5,86.53h0Z"/>
            <path class="st5" d="M799.88,137.98h128.86v-55.24h-137.45c.91,18.69,3.65,37.23,8.58,55.24h.01Z"/>
            <rect class="st1" x="393.62" y="94.52" width="37.24" height="31.69"/>
            <line class="st0" x1="430.85" y1="94.51" x2="393.61" y2="126.2"/>
            <line class="st0" x1="430.85" y1="126.2" x2="393.61" y2="94.51"/>
            <path class="st4" d="M380.42,654.49v210.71h43.78c2.13-9.34,5.69-18.21,11.63-25.83,12.25-15.71,32.23-21.8,51.21-24.47,26.08-3.66,51.48-1.31,76.35,7.46,30.56,10.78,58.14,28.78,87.27,42.84h232.04v-210.71h-502.28Z"/>
            <path class="st15" d="M460.25,314.69l12.08-38.71c-1.34-3.46-2.08-7.22-2.08-11.17v-45.85c0-16.89,13.46-30.58,30.07-30.58h152.85c16.61,0,30.07,13.69,30.07,30.58v45.85c0,16.89-13.46,30.58-30.07,30.58h-152.85c-.89,0-1.77-.05-2.64-.12l-37.43,19.42h0Z"/>

            <path class="st14" id="boton" d="M860.02,810.14l-21.89-29.19c2.42-2.61,3.77-5.45,3.77-8.42v-34.58c0-12.73-23.25,10.44-54.49-23.06s-276.99,0-276.99,0c-30.09,0-115.29,12.81-54.49,23.06,60.8,10.25,0,34.58,0,34.58,0,12.73,24.39,23.06,54.49,23.06h276.99c1.61,0,3.21-.04,4.78-.09l67.83,14.64h0Z"/> <!--IMPORTANTE-->

            <path class = "st50" id="fase2" d="M662.04,345.64h152.85c14.15,0,26.02,9.95,29.21,23.34-1.41,8.58-1.03,17.47.85,26.12v26.97c0,3.94-.74,7.71-2.08,11.17l12.08,38.71-37.43-19.42c-.87.08-1.75.12-2.64.12h-152.85c-16.61,0-30.07-13.69-30.07-30.58v-45.85c0-16.89,13.46-30.58,30.07-30.58h0Z"/>
            <path class="st12" id="fase3" d="M460.25,626.37l12.08-38.71c-1.34-3.46-2.08-7.22-2.08-11.17v-45.85c0-16.89,13.46-30.58,30.07-30.58h152.85c16.61,0,30.07,13.69,30.07,30.58v45.85c0,16.89-13.46,30.58-30.07,30.58h-152.85c-.89,0-1.77-.05-2.64-.12l-37.43,19.42h0Z"/>
            <path class="st1" d="M380.08,369.79c-1.91-17.45-12.42-29.7-26.39-37.25v97.48s.1-.08.15-.12c17.19-14.53,28.74-37.26,26.24-60.11h0Z"/>
            <line class="st2" id="fase2" x1="674.79" y1="369.32" x2="802.44" y2="430.02"/>
            <line class="st2" id="fase2" x1="683.24" y1="430.02" x2="802.44" y2="363.14"/>
            <g class="st10">
                <text class="st9" transform="translate(495.69 232.4)"><tspan x="0" y="0">¬øQuieres jugar </tspan><tspan x="0" y="25.2">un juego?</tspan></text>
            </g>
            <g class="st10">
                <text class="st11" id="fase3" transform="translate(494.02 545.13)"><tspan class="st8" x="0" y="0">¬ø</tspan><tspan class="st13" x="15.58" y="0">‚∏Æœæ ¨‚ï¨ û·òø‚ÑßÀû</tspan><tspan class="st8" x="111.58" y="0"> </tspan><tspan class="st13" x="116.04" y="0">…Ö”Ñ‚âΩ‚ö†·ïØ</tspan><tspan class="st7" x="176.04" y="0"> </tspan><tspan class="st13" x="0" y="28.8">êå∞œ´…∏</tspan><tspan class="st8" x="36" y="28.8">‚Ç™</tspan><tspan class="st13" x="62.16" y="28.8">’û</tspan><tspan class="st8" x="74.16" y="28.8">?</tspan></text>
            </g>
            <g class="st10">
                <text class="st6" id="fase1" transform="translate(577.85 755.07)"><tspan x="0" y="0">SI, DE UNA</tspan></text>
                <text class="st61" id="fase4" transform="translate(577.85 755.07)"><tspan x="0" y="0">....................</tspan></text>
            </g>



   
            </svg>
        </div>

        <div class="spike1-fase-1" id="fase1">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1.svg">
        </div>

        <div class="spike2-fase-1" id="fase1">
            <img id="Spike 2-1" src="Imagenes/etapa3/spike1.svg">
        </div>

        <div class="spike3-fase-1" id="fase1">
            <img id="Spike 3-1" src="Imagenes/etapa3/spike1.svg">
        </div>

        <div class="spike4-fase-1" id="fase1">
            <img id="Spike 4-1" src="Imagenes/etapa3/spike2.svg">
        </div>  

        <div class="spike5-fase-1" id="fase1">     
            <img id="Spike 5-1" src="Imagenes/etapa3/spike2.svg">
        </div>

        <div class="spike6-fase-1" id="fase1">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2.svg">
        </div>




        <div class="spike1-fase-2" id="fase2">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase2.svg">
        </div>

        <div class="spike2-fase-2" id="fase2">
            <img id="Spike 2-1" src="Imagenes/etapa3/spike1-fase2.svg">
        </div>

        <div class="spike3-fase-2" id="fase2">
            <img id="Spike 3-1" src="Imagenes/etapa3/spike1-fase2.svg">
        </div>

        <div class="spike4-fase-2" id="fase2">
            <img id="Spike 4-1" src="Imagenes/etapa3/spike2-fase2.svg">
        </div>  

        <div class="spike5-fase-2" id="fase2">     
            <img id="Spike 5-1" src="Imagenes/etapa3/spike2-fase2.svg">
        </div>

        <div class="spike6-fase-2" id="fase2">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase2.svg">
        </div>



        <div class="spike1-fase-3" id="fase3">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike2-fase-3" id="fase3">
            <img id="Spike 2-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike3-fase-3" id="fase3">
            <img id="Spike 3-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike4-fase-3" id="fase3">
            <img id="Spike 4-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>  

        <div class="spike5-fase-3" id="fase3">     
            <img id="Spike 5-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike6-fase-3" id="fase3">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>



        <div class="spike spike1x-fase-4" id="animacion1">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike2x-fase-4" id="animacion1">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike3x-fase-4" id="animacion1">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike4x-fase-4" id="animacion2">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike5x-fase-4" id="animacion3">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

         <div class="spike spike6x-fase-4" id="animacion1">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike7x-fase-4" id="animacion2">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>

        <div class="spike spike8x-fase-4" id="animacion3">
            <img id="Spike 1-1" src="Imagenes/etapa3/spike1-fase3.svg">
        </div>


        <div class="spike spike9x-fase-3" id="animacion1">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>
        
        <div class="spike spike10x-fase-3" id="animacion1">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike11x-fase-3" id="animacion2">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike12x-fase-3" id="animacion2">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike12x-fase-3" id="animacion3">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike14x-fase-3" id="animacion2">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike15x-fase-3" id="animacion2">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

        <div class="spike spike16x-fase-3" id="animacion3">
            <img id="Spike 6-1" src="Imagenes/etapa3/spike2-fase3.svg">
        </div>

    </main>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const pathBoton = document.getElementById("boton");
    const audio = document.getElementById("audio");
    let faseActual = 1;
    let audioReproducido = false;
    let fase4Activada = false; // Nueva variable para controlar fase 4

    if (pathBoton) {
        pathBoton.addEventListener("click", () => {
            // Si ya estamos en fase 4, no hacer nada
            if (fase4Activada) return;

            // Reproducir audio solo en el primer click
            if (!audioReproducido) {
                audio.play().catch(error => {
                    console.error("Error al reproducir audio:", error);
                    document.body.addEventListener('click', () => audio.play(), { once: true });
                });
                audioReproducido = true;
            }

            // Avanzar fase
            if(faseActual < 4) {
                faseActual++;
                const nuevaFase = `fase${faseActual}`;
                document.body.setAttribute("data-hash", nuevaFase);
                
                // Si llegamos a fase 4, marcarlo
                if (faseActual === 4) {
                    fase4Activada = true;
                    // Opcional: deshabilitar visualmente el bot√≥n
                    pathBoton.style.pointerEvents = "none";
                    pathBoton.style.opacity = "0.5";
                }
            }
        });
    }
});
</script>

<script>
// Variable global para almacenar las posiciones de las spikes
const spikesPositions = [];

const randomizeSpikesInFase4 = () => {
    const body = document.body;

    if (body.dataset.hash === "fase4") {
        // Si ya tenemos posiciones guardadas, usarlas en lugar de generar nuevas
        if (spikesPositions.length > 0) {
            spikesPositions.forEach((pos, index) => {
                const spike = document.querySelectorAll(".spike")[index];
                if (spike) {
                    spike.style.position = "absolute";
                    spike.style.top = `${pos.top}%`;
                    spike.style.left = `${pos.left}%`;
                    spike.style.transform = `rotate(${pos.rot}deg) scale(1)`;
                    spike.style.opacity = "1";
                    spike.style.display = "block";
                    spike.style.visibility = "visible";
                }
            });
            return;
        }

        const spikes = document.querySelectorAll(".spike");
        const usedPositions = [];
        const minDistance = 15;

        spikes.forEach((spike, index) => {
            let top, left;
            let attempts = 0;

            do {
                top = Math.random() * 80;
                left = Math.random() * 90;
                attempts++;

                const tooClose = usedPositions.some(pos => {
                    const dx = pos.left - left;
                    const dy = pos.top - top;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    return distance < minDistance;
                });

                if (!tooClose) break;
            } while (attempts < 100);

            const rot = Math.floor(Math.random() * 360);
            usedPositions.push({ top, left, rot });
            
            // Guardar posici√≥n para futuras repeticiones
            spikesPositions.push({ top, left, rot });

            const delay = 500 + index * 600;

            spike.style.position = "absolute";
            spike.style.top = `${top}%`;
            spike.style.left = `${left}%`;
            spike.style.transform = `rotate(${rot}deg) scale(0.5)`;
            spike.style.opacity = "0";
            spike.style.display = "block";
            spike.style.visibility = "visible";
            spike.style.transition = "transform 0.4s ease, opacity 0.4s ease";

            setTimeout(() => {
                spike.style.opacity = "1";
                spike.style.transform = `rotate(${rot}deg) scale(1)`;
            }, delay);
        });
    }
};

const observer = new MutationObserver(() => {
    if (document.body.dataset.hash === "fase4") {
        randomizeSpikesInFase4();
    }
});

observer.observe(document.body, {
    attributes: true,
    attributeFilter: ['data-hash']
});

document.addEventListener("DOMContentLoaded", randomizeSpikesInFase4);
</script>
</body>
</html>